<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>三隻狗狗 AR 辨識互動</title>
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    #dogVideo, #infoBtn, #dogInfo {
      display: none;
      position: absolute;
      left: 20px;
      background: rgba(255,255,255,0.9);
      border-radius: 5px;
      padding: 10px;
    }
    #dogVideo { bottom: 100px; width: 300px; }
    #infoBtn { bottom: 60px; background:#4CAF50; color:#fff; border:none; cursor:pointer; }
    #dogInfo { bottom: 20px; max-width: 300px; }
  </style>
</head>
<body>
  <video id="dogVideo" controls muted playsinline></video>
  <button id="infoBtn">顯示狗狗資訊</button>
  <div id="dogInfo"></div>

  <a-scene mindar-image="imageTargetSrc: ./dogTargets.mind; filtered: false;"
           vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    <a-camera position="0 0 0"></a-camera>

    <!-- 三個 target，放透明平面確保事件觸發 -->
    <a-entity mindar-image-target="targetIndex: 0">
      <a-plane position="0 0 0" rotation="-90 0 0" width="1" height="1" opacity="0"></a-plane>
    </a-entity>
    <a-entity mindar-image-target="targetIndex: 1">
      <a-plane position="0 0 0" rotation="-90 0 0" width="1" height="1" opacity="0"></a-plane>
    </a-entity>
    <a-entity mindar-image-target="targetIndex: 2">
      <a-plane position="0 0 0" rotation="-90 0 0" width="1" height="1" opacity="0"></a-plane>
    </a-entity>
  </a-scene>

  <script>
    const dogData = [
      { key: "husky", name: "哈士奇", desc: "活潑雪橇犬", video:"husky.mp4" },
      { key:"dog2", name:"柴犬", desc:"傲嬌日本犬", video:"dog2.mp4" },
      { key:"dog3", name:"吉娃娃", desc:"迷你玩伴", video:"dog3.mp4" }
    ];

    const video = document.getElementById("dogVideo");
    const btn = document.getElementById("infoBtn");
    const info = document.getElementById("dogInfo");

    document.addEventListener("DOMContentLoaded", () => {
      const sceneEl = document.querySelector("a-scene");
      const mindarComponent = sceneEl.components["mindar-image"];

      sceneEl.addEventListener("arReady", () => {
        mindarComponent.start();
      });

      sceneEl.addEventListener("targetFound", (event) => {
        const index = event.detail.index;
        if (dogData[index]) {
          const dog = dogData[index];
          video.src = dog.video;
          video.style.display = "block";
          btn.style.display = "inline-block";
          info.style.display = "none";

          btn.onclick = () => {
            info.innerHTML = `<strong>${dog.name}</strong><p>${dog.desc}</p>`;
            info.style.display = "block";
          };

          video.play();
        }
      });

      sceneEl.addEventListener("targetLost", (event) => {
        video.pause();
        video.style.display = "none";
        btn.style.display = "none";
        info.style.display = "none";
      });
    });
  </script>
</body>
</html>
